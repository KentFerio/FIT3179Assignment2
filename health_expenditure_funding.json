{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "width": 400,
  "height": 375,

  "data": {
    "url": "https://raw.githubusercontent.com/KentFerio/FIT3179Assignment2/refs/heads/main/A2_source_of_funds.csv",
    "format": {
      "type": "csv",
      "parse": {"Year": "number", "Value ($billion)": "number"}
    }
  },

  "params": [
    {
      "name": "yearSelector",
      "value": 2020,
      "bind": {
        "input": "select",
        "options": [2011,2012,2013,2014,2015,2016,2017,2018,2019,2020],
        "name": "Select Year: "
      }
    }
  ],

  "transform": [
    {"filter": "datum.Year == yearSelector"},
    {
      "calculate": "indexof(['Government','Non-government'], datum['Main source'])",
      "as": "MainOrder"
    },
    {
      "calculate": "indexof(['Australian government','State and local government','Health insurance funds','Individuals','Other non-government'], datum['Source'])",
      "as": "SourceOrder"
    }
  ],

  "resolve": {"scale": {"color": "independent"}},

  "layer": [
    {
      "mark": {"type": "arc", "innerRadius": 0, "outerRadius": 40, "color": "lightgray"},
      "encoding": {
        "theta": {"aggregate": "sum", "field": "Value ($billion)"},
        "tooltip": [
          {"aggregate": "sum", "field": "Value ($billion)", "title": "Total (Billion AUD)", "format": ".2f"}
        ]
      }
    },

    {
      "mark": {"type": "arc", "innerRadius": 45, "outerRadius": 100, "stroke": "white", "strokeWidth": 1},
      "encoding": {
        "theta": {"aggregate": "sum", "field": "Value ($billion)", "stack": true},
        "order": {"field": "MainOrder"},
        "color": {
          "field": "Main source",
          "type": "nominal",
          "scale": {
            "domain": ["Government", "Non-government"],
            "range": ["#4e79a7", "#59a14f"]
          },
          "legend": null
        },
        "tooltip": [
          {"field": "Main source", "title": "Main Source"},
          {"aggregate": "sum", "field": "Value ($billion)", "title": "Expenditure (Billion AUD)", "format": ".2f"}
        ]
      }
    },

    {
      "mark": {"type": "arc", "innerRadius": 105, "outerRadius": 180, "stroke": "white", "strokeWidth": 1},
      "encoding": {
        "theta": {"field": "Value ($billion)", "type": "quantitative", "stack": true},
        "order": {"field": "SourceOrder"},
        "color": {
          "field": "Source",
          "type": "nominal",
          "scale": {
            "domain": [
              "Australian government",
              "State and local government",
              "Health insurance funds",
              "Individuals",
              "Other non-government"
            ],
            "range": [
              "#6baed6",
              "#9ecae1",
              "#74c476",
              "#31a354",
              "#006d2c"
            ]
          },
          "legend": null
        },
        "tooltip": [
          {"field": "Main source", "title": "Main Source"},
          {"field": "Source", "title": "Detailed Source"},
          {"field": "Value ($billion)", "title": "Expenditure (Billion AUD)", "format": ".2f"}
        ]
      }
    },

    {
      "mark": {"type": "text", "text": "Total Funds", "fontSize": 16, "color": "#333"}
    }
  ],

  "view": {"stroke": null},
  "config": {"background": "white"}
}
